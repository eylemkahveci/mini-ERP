<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>Mini-ERP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./app/css/styles.css" rel="stylesheet">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.jsdelivr.net; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; connect-src 'self'; img-src 'self' data:;">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#" data-view="products">Mini-ERP</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="nav" class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" id="nav-dashboard" href="#" data-view="dashboard" data-roles="ADMIN,MUHASEBE">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" id="nav-products" href="#" data-view="products" data-roles="ADMIN,DEPO,MUHASEBE">Ürünler</a></li>
        <li class="nav-item"><a class="nav-link" id="nav-stock" href="#" data-view="stock" data-roles="ADMIN,DEPO">Stok Hareketleri</a></li>
        <li class="nav-item"><a class="nav-link" id="nav-reports" href="#" data-view="reports" data-roles="ADMIN,MUHASEBE">Raporlar</a></li>
        <li class="nav-item"><a class="nav-link" id="nav-categories" href="#" data-view="categories" data-roles="ADMIN">Kategoriler</a></li>
        <li class="nav-item"><a class="nav-link" id="nav-users" href="#" data-view="users" data-roles="ADMIN">Kullanıcılar</a></li>
      </ul>
      <span class="navbar-text me-3" id="nav-username"></span>
      <button class="btn btn-outline-light" id="btn-logout">Çıkış</button>
    </div>
  </div>
  </nav>

<div class="container py-4">
  <div id="view-login" class="view">
    <div class="row justify-content-center">
      <div class="col-md-4">
        <h4 class="mb-3">Giriş Yap</h4>
        <div class="mb-3">
          <label class="form-label">Kullanıcı Adı</label>
          <input type="text" class="form-control" id="login-username">
        </div>
        <div class="mb-3">
          <label class="form-label">Şifre</label>
          <input type="password" class="form-control" id="login-password">
        </div>
        <button class="btn btn-primary w-100" id="btn-login">Giriş</button>
        <div class="text-danger small mt-2" id="login-error"></div>
      </div>
    </div>
  </div>

  <div id="view-dashboard" class="view d-none">
    <h4 class="mb-3">Dashboard</h4>
    <div class="row g-3 mb-3">
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <div class="text-muted small">Toplam Ürün</div>
            <div class="fs-4" id="db-total-products">-</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <div class="text-muted small">Düşük Stok</div>
            <div class="fs-4" id="db-low-stock">-</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <div class="text-muted small">Tükenen</div>
            <div class="fs-4" id="db-out-stock">-</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <div class="text-muted small">Toplam Envanter Değeri</div>
            <div class="fs-5" id="db-total-value">-</div>
          </div>
        </div>
      </div>
    </div>
    <button class="btn btn-outline-secondary" id="btn-db-refresh">Yenile</button>
    <div class="small text-muted mt-2">Değerler ürün listesinden hesaplanır (fiyat x miktar).</div>
  </div>

  <div id="view-products" class="view d-none">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Ürünler</h4>
      <button class="btn btn-success" id="btn-refresh-products">Yenile</button>
    </div>
    <div class="card mb-4" id="card-create-product">
      <div class="card-body">
        <h5 class="card-title">Yeni Ürün</h5>
        <div class="row g-3">
          <div class="col-md-4"><input class="form-control" id="p-name" placeholder="Ürün Adı"></div>
          <div class="col-md-3"><input class="form-control" id="p-sku" placeholder="SKU"></div>
          <div class="col-md-2"><input class="form-control" id="p-price" placeholder="Fiyat"></div>
          <div class="col-md-2"><input class="form-control" id="p-qty" placeholder="Miktar"></div>
          <div class="col-md-3"><input class="form-control" id="p-critical" placeholder="Kritik Seviye"></div>
          <div class="col-md-4">
            <select class="form-select" id="p-category"></select>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100" id="btn-create-product">Ekle</button>
          </div>
          <div class="col-12 text-danger small" id="product-error"></div>
        </div>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped align-middle" id="products-table">
        <thead>
          <tr>
            <th>SKU</th><th>Ad</th><th>Fiyat</th><th>Durum</th><th>Kategori</th><th>Miktar</th><th>Kritik</th><th>İşlem</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  <!-- Ürün Düzenleme Modal -->
  <div class="modal fade" id="productEditModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Ürün Düzenle</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Ad</label>
              <input class="form-control" id="ep-name">
            </div>
            <div class="col-md-3">
              <label class="form-label">SKU</label>
              <input class="form-control" id="ep-sku">
            </div>
            <div class="col-md-3">
              <label class="form-label">Fiyat</label>
              <input class="form-control" id="ep-price">
            </div>
            <div class="col-md-2">
              <label class="form-label">Miktar</label>
              <input class="form-control" id="ep-qty">
            </div>
            <div class="col-md-3">
              <label class="form-label">Kritik Seviye</label>
              <input class="form-control" id="ep-critical">
            </div>
            <div class="col-md-4">
              <label class="form-label">Kategori</label>
              <select class="form-select" id="ep-category"></select>
            </div>
            <div class="col-12 text-danger small" id="ep-error"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
          <button type="button" class="btn btn-primary" id="btn-ep-save">Kaydet</button>
        </div>
      </div>
    </div>
  </div>

  <div id="view-stock" class="view d-none">
    <h4 class="mb-3">Stok Hareketleri</h4>
    <div class="card mb-4">
      <div class="card-body">
        <div class="row g-3 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Ürün</label>
            <select class="form-select" id="sm-product"></select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Tip</label>
            <select class="form-select" id="sm-type">
              <option value="IN">IN</option>
              <option value="OUT">OUT</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Miktar</label>
            <input class="form-control" id="sm-qty" placeholder="Miktar">
          </div>
          <div class="col-md-3">
            <label class="form-label">Açıklama</label>
            <input class="form-control" id="sm-desc" placeholder="Açıklama">
          </div>
          <div class="col-md-1">
            <button class="btn btn-primary w-100" id="btn-sm-submit">Kaydet</button>
          </div>
          <div class="col-12 text-danger small" id="sm-error"></div>
        </div>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-hover" id="movements-table">
        <thead>
          <tr>
            <th>Tarih</th><th>Ürün</th><th>Tip</th><th>Miktar</th><th>Açıklama</th><th>İşlemi Yapan</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="view-reports" class="view d-none">
    <h4 class="mb-3">Raporlar</h4>
    <div class="d-flex gap-3">
      <button class="btn btn-outline-primary" id="btn-report-excel">Düşük Stok Excel</button>
      <button class="btn btn-outline-danger" id="btn-report-pdf">Düşük Stok PDF</button>
    </div>
  </div>

  <div id="view-categories" class="view d-none">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Kategoriler</h4>
      <button class="btn btn-success" id="btn-refresh-categories">Yenile</button>
    </div>
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Yeni Kategori</h5>
        <div class="row g-3 align-items-end">
          <div class="col-md-6">
            <input class="form-control" id="cat-name" placeholder="Kategori Adı">
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100" id="btn-create-category">Ekle</button>
          </div>
          <div class="col-12 text-danger small" id="category-error"></div>
        </div>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped align-middle" id="categories-table">
        <thead>
          <tr>
            <th>Ad</th><th>İşlem</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="view-users" class="view d-none">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Kullanıcılar</h4>
      <button class="btn btn-success" id="btn-refresh-users">Yenile</button>
    </div>
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Yeni Kullanıcı</h5>
        <div class="row g-3 align-items-end">
          <div class="col-md-3"><input class="form-control" id="u-username" placeholder="Kullanıcı Adı"></div>
          <div class="col-md-3"><input type="password" class="form-control" id="u-password" placeholder="Şifre"></div>
          <div class="col-md-3">
            <select class="form-select" id="u-role">
              <option value="ADMIN">ADMIN</option>
              <option value="DEPO">DEPO</option>
              <option value="MUHASEBE">MUHASEBE</option>
            </select>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100" id="btn-create-user">Ekle</button>
          </div>
          <div class="col-12 text-danger small" id="user-error"></div>
        </div>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped align-middle" id="users-table">
        <thead>
          <tr>
            <th>ID</th><th>Kullanıcı Adı</th><th>Rol</th><th>İşlem</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="./app/js/api.js"></script>
<script src="./app/js/auth.js"></script>
<script src="./app/js/products.js"></script>
<script src="./app/js/stock.js"></script>
<script src="./app/js/reports.js"></script>
<script src="./app/js/categories.js"></script>
<script src="./app/js/dashboard.js"></script>
<script src="./app/js/users.js"></script>
<script src="./app/js/main.js"></script>
</body>
</html>
